var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}import React from'react';import{isMobile}from'./utils';import{ItemWrapper}from'./components/itemWrapper';import{map}from'ramda';import{calculate}from'./utils';import NothingToShow from'./components/nothingToShow';var gridStyle={height:0,overflow:'auto',WebkitOverflowScrolling:isMobile()?'touch':void 0},gridInner={display:'flex',flexGrow:1,flexBasis:1,flexWrap:'wrap',overflow:'auto'};var Grid=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));c.gridElement=void 0;return c.state={itemsCount:0,wrapperHeight:0,wrapperWidth:0,itemWidth:0,itemHeight:0,visibleIndices:{first:0,last:0},itemsInRow:0},c}return _inherits(b,a),_createClass(b,[{key:'getVisibleIndieces',value:function getVisibleIndieces(){var a=calculate.itemsInRow({wrapperWidth:this.props.width?this.props.width:this.state.wrapperWidth,itemWidth:this.props.itemWidth}),b=calculate.visibleItemIndices({itemsInRow:a,wrapperHeight:this.props.height,totalItems:this.state.itemsCount,itemHeight:this.props.itemHeight,amountScrolled:this.gridElement?this.gridElement.scrollTop:0});return{visibleIndices:b,itemsInRow:a}}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){var b=this;this.setState({itemsCount:a.items.length},function(){var a=b.getVisibleIndieces(),c=a.visibleIndices,d=a.itemsInRow;b.setState({visibleIndices:c,itemsInRow:d})}),this.gridElement&&(this.gridElement.scrollTop=0)}},{key:'componentDidMount',value:function componentDidMount(){var a=this;this.gridElement&&this.gridElement.addEventListener('scroll',function(){var b=a.getVisibleIndieces(),c=b.visibleIndices,d=b.itemsInRow;a.setState({visibleIndices:c,itemsInRow:d})}),this.setState({wrapperHeight:this.gridElement?this.gridElement.offsetHeight:0,itemsCount:this.props.items.length,itemWidth:this.props.itemWidth,itemHeight:this.props.itemHeight,wrapperWidth:this.gridElement?this.gridElement.offsetWidth:0},function(){var b=a.getVisibleIndieces(),c=b.visibleIndices,d=b.itemsInRow;a.setState({visibleIndices:c,itemsInRow:d})}),window.addEventListener('resize',function(){a.gridElement&&a.setState({wrapperWidth:a.gridElement.offsetWidth},function(){var b=a.getVisibleIndieces(),c=b.visibleIndices,d=b.itemsInRow;a.setState({visibleIndices:c,itemsInRow:d})})},!0)}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(a,b){var c=this.state.visibleIndices,d=b.visibleIndices;return d.first&&1===d.first||(d.first===c.first&&d.last===c.last?!1:!0)}},{key:'render',value:function render(){var a=this,b=this.props,c=b.itemHeight,d=b.itemWidth,e=Object.assign({},gridStyle,{height:this.props.height,width:this.props.width||'auto',minWidth:d}),f=calculate.wrapperHeight(this.state),g=this.state,h=g.itemsInRow,i=g.visibleIndices,j=i.first,k=i.last,l=this.props.items.slice(j-1,k),m=calculate.spaceBefore({first:j,itemsInRow:h,itemHeight:c}),n=calculate.spaceAfter({last:k,itemsInRow:h,itemHeight:c,containerHeight:f});return React.createElement('div',{className:'grid',style:e,ref:function ref(b){a.gridElement=b}},React.createElement('div',{className:'grid-inner',style:Object.assign({height:f,minHeight:this.state.wrapperHeight},gridInner)},React.createElement('div',{className:'space-before',style:{height:m,flexBasis:'100%',flexGrow:1,display:m?'block':'none'}}),!l.length&&React.createElement(NothingToShow,null),map(function(b){return React.createElement(ItemWrapper,{key:Math.random(),height:a.props.itemHeight,itemsInRow:h,child:b})},l),React.createElement('div',{className:'space-after',style:{height:n,flexBasis:'100%',flexGrow:1,display:n?'block':'none'}})))}}]),b}(React.Component);export{Grid,calculate,Grid as default};